<!DOCTYPE html>
<html>
  <head>
    {% load slider_tags %}
      {% load staticfiles %}
      <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js'></script>
        <script src="{% static "search/moment.js"%}"></script>
      <link rel="stylesheet" type="text/css" href="{% static "search/slider.css" %}" />
      
    <style type="text/css">
      html, body { 
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        height: 100%;
      }
      #slider {      
         position: absolute;
         bottom: 2.5%;
         z-index: 5;
         left: 12.5%;
         padding: 5px;  
         width: 75%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script type="text/javascript">

var map;
function initMap() {
  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: -34.397, lng: 150.644},
    zoom: 8
  });

  map.addListener('click', function(e) {
    var lat = e.latLng.lat();
    var lng = e.latLng.lng();
    var dist = 20000; //CHANGE LATER (IMPLEMENT DIST SELECT) -> in metres
    window.location.href = '/search/map/results?lat=' + lat + '&lng=' + lng + 
                           '&dist=' + dist;
//    httpGetAsync('map/results?lat=' + lat + '&lng=' + lng, testCallback);
  });
}

function httpGetAsync(url, callback) {
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
      if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
        callback(xmlHttp.responseText);
      }
    }
    xmlHttp.open("GET", url, true); // true for asynchronous 
    xmlHttp.send(null);
}

function testCallback(responseText) {
  alert(responseText);
}


    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBqr-bcICmK4xrq1I2UAdC7z7S85D0_BxI&callback=initMap">
    </script>
    </div>
    
    <script type="text/javascript">
    // DOM Ready
$(function() {
 var el, nx, newPoint, newPlace, offset;
 
 // Select all range inputs, watch for change
 $("input[type='range']").on('input', function() {
 
   // Cache this for efficiency
   el = $(this);
   nx = el.next("output");
   // Measure width of range input
   width = el.width();
   // Figure out placement percentage between left and right of input
   newPoint = (el.val() - el.attr("min")) / (el.attr("max") - el.attr("min"));
   //console.log(el.val());
   
   // Prevent bubble from going beyond left or right (unsupported browsers)
   if (newPoint < 0) { newPlace = 0; }
   else if (newPoint > 1) { newPlace = width; }
   else {newPlace = width * newPoint}
   
   // Move bubble
   nx.css({left: newPlace})
     .text(selectedDate(el.val()));
 })
 // Fake a change to position bubble at page load
 .trigger('input');
});

function selectedDate(days) {
    var selected;
    selected = moment("1850-01-01");
    selected.add(days, 'd');
    return selected.format("DD MMM YYYY");
}
</script>

    <div id="slider">
      <input type="range" name="foo" min=0 max={% time_from_start %}>
      <output for="foo">0</output>
    </div>
  </body>
</html>
